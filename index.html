<!DOCTYPE html>
<html>
<head>
  <title>Split Bill - Tariska & Friends</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, select, button { margin: 5px; padding: 5px; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 5px; }
    th { background-color: #f0f0f0; }
    td button { margin: 2px; }
  </style>
</head>
<body>
  <h2>ğŸ’¸ Split Bill - Tariska & Friends</h2>

  <label>Description: <input id="desc" /></label>
  <label>Paid By:
    <select id="paidBy">
      <option>Tariska</option>
      <option>Delano</option>
      <option>Lika</option>
      <option>Husin</option>
    </select>
  </label><br>

  <h3>Who Shared and How Much?</h3>
  <table>
    <tr><th>Name</th><th>Amount (Rp)</th></tr>
    <tr><td>Tariska</td><td><input type="number" id="Tariska" value="0"></td></tr>
    <tr><td>Delano</td><td><input type="number" id="Delano" value="0"></td></tr>
    <tr><td>Lika</td><td><input type="number" id="Lika" value="0"></td></tr>
    <tr><td>Husin</td><td><input type="number" id="Husin" value="0"></td></tr>
  </table><br>

  <button onclick="addExpense()">Add Expense</button>

  <h3>ğŸ§¾ Expenses</h3>
  <table id="expenseTable">
    <tr><th>Description</th><th>Paid By</th><th>Details</th><th>Actions</th></tr>
  </table>

  <h3>ğŸ“Š Who Owes Whom</h3>
  <pre id="result"></pre>

  <script>
    const names = ["Tariska", "Delano", "Lika", "Husin"];
    let expenses = [];

    function getInputData() {
      const desc = document.getElementById("desc").value;
      const paidBy = document.getElementById("paidBy").value;
      const shares = {};
      let total = 0;

      names.forEach(name => {
        const amt = parseFloat(document.getElementById(name).value) || 0;
        shares[name] = amt;
        total += amt;
      });

      return { desc, paidBy, shares, total };
    }

    function addExpense(isEdit = false, editIndex = null) {
      const { desc, paidBy, shares, total } = getInputData();

      if (!desc || total === 0) {
        alert("Please enter a description and non-zero shared amounts.");
        return;
      }

      if (isEdit) {
        expenses[editIndex] = { desc, paidBy, shares };
      } else {
        expenses.push({ desc, paidBy, shares });
      }

      updateTable();
      updateResult();
      clearInputs();
    }

    function deleteExpense(index) {
      expenses.splice(index, 1);
      updateTable();
      updateResult();
    }

    function editExpense(index) {
      const expense = expenses[index];
      document.getElementById("desc").value = expense.desc;
      document.getElementById("paidBy").value = expense.paidBy;
      names.forEach(name => {
        document.getElementById(name).value = expense.shares[name] || 0;
      });

      // Change button temporarily to "Update"
      const addBtn = document.querySelector("button[onclick='addExpense()']");
      addBtn.textContent = "Update Expense";
      addBtn.onclick = function () {
        addExpense(true, index);
        addBtn.textContent = "Add Expense";
        addBtn.onclick = () => addExpense();
      };
    }

    function updateTable() {
      const table = document.getElementById("expenseTable");
      table.innerHTML = `<tr><th>Description</th><th>Paid By</th><th>Details</th><th>Actions</th></tr>`;

      expenses.forEach((e, index) => {
        const details = Object.entries(e.shares)
          .filter(([n, amt]) => amt > 0)
          .map(([n, amt]) => `${n}: Rp ${amt.toLocaleString('id-ID')}`)
          .join('<br>');
        table.innerHTML += `
          <tr>
            <td>${e.desc}</td>
            <td>${e.paidBy}</td>
            <td>${details}</td>
            <td>
              <button onclick="editExpense(${index})">âœï¸ Edit</button>
              <button onclick="deleteExpense(${index})">ğŸ—‘ Delete</button>
            </td>
          </tr>`;
      });
    }

    function updateResult() {
      const balances = {};
      const ledger = {};

      names.forEach(n => {
        balances[n] = 0;
        ledger[n] = {};
        names.forEach(n2 => {
          if (n !== n2) ledger[n][n2] = 0;
        });
      });

      expenses.forEach(({ paidBy, shares }) => {
        names.forEach(name => {
          const share = shares[name];
          if (name !== paidBy && share > 0) {
            balances[name] -= share;
            balances[paidBy] += share;
            ledger[name][paidBy] += share;
          }
        });
      });

      let output = "";
      names.forEach(p => {
        for (let o of names) {
          if (p !== o && ledger[p][o] > 0) {
            output += `${p} owes ${o}: Rp ${ledger[p][o].toLocaleString('id-ID')}\n`;
          }
        }
      });

      document.getElementById("result").textContent = output || "ğŸ‰ All settled!";
    }

    function clearInputs() {
      document.getElementById("desc").value = "";
      names.forEach(name => document.getElementById(name).value = "0");
    }
  </script>
</body>
</html>
