<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Split Bill with Friends</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select { margin: 5px; }
    .transaction { margin: 10px 0; border-bottom: 1px solid #ccc; padding-bottom: 5px; }
  </style>
</head>
<body>
  <h2>Split Bill - Indonesia</h2>

  <label>Payer:</label>
  <select id="payer">
    <option>Tariska</option>
    <option>Delano</option>
    <option>Lika</option>
    <option>Husin</option>
  </select><br>

  <label>Description:</label>
  <input type="text" id="description" placeholder="e.g. Hotel" /><br>

  <label>Amount (Rp):</label>
  <input type="number" id="amount" /><br>

  <label>Who joined?</label><br>
  <input type="checkbox" class="member" value="Tariska" checked> Tariska
  <input type="checkbox" class="member" value="Delano" checked> Delano
  <input type="checkbox" class="member" value="Lika" checked> Lika
  <input type="checkbox" class="member" value="Husin" checked> Husin<br>

  <label><input type="checkbox" id="splitEqual" checked> Split equally?</label><br>

  <div id="unequalInputs" style="display:none;">
    <p>Input individual amounts (Rp):</p>
    <div id="individualInputs"></div>
  </div>

  <button onclick="addTransaction()">Add</button>

  <h3>Transactions</h3>
  <div id="transactions"></div>

  <h3>Summary</h3>
  <div id="summary"></div>

  <script>
    const members = ["Tariska", "Delano", "Lika", "Husin"];
    const transactions = [];

    document.getElementById("splitEqual").addEventListener("change", function () {
      const show = !this.checked;
      document.getElementById("unequalInputs").style.display = show ? "block" : "none";
      if (show) renderUnequalInputs();
    });

    function renderUnequalInputs() {
      const container = document.getElementById("individualInputs");
      container.innerHTML = "";
      document.querySelectorAll(".member:checked").forEach(cb => {
        const name = cb.value;
        const input = document.createElement("input");
        input.type = "number";
        input.placeholder = `${name}'s share`;
        input.id = `amount-${name}`;
        container.appendChild(document.createTextNode(name));
        container.appendChild(input);
        container.appendChild(document.createElement("br"));
      });
    }

    function addTransaction(editIndex = null) {
      const payer = document.getElementById("payer").value;
      const description = document.getElementById("description").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const splitEqually = document.getElementById("splitEqual").checked;

      const selected = [...document.querySelectorAll(".member:checked")].map(cb => cb.value);

      if (selected.length === 0 || isNaN(amount) || amount <= 0) {
        alert("Please fill in valid data.");
        return;
      }

      let shares = {};
      if (splitEqually) {
        const share = Math.round((amount / selected.length));
        selected.forEach(name => shares[name] = share);
      } else {
        let totalInput = 0;
        selected.forEach(name => {
          const val = parseFloat(document.getElementById(`amount-${name}`).value || 0);
          shares[name] = val;
          totalInput += val;
        });
        if (Math.abs(totalInput - amount) > 1) {
          alert("Total of individual shares must equal the total amount.");
          return;
        }
      }

      const data = { payer, description, amount, shares };

      if (editIndex !== null) {
        transactions[editIndex] = data;
      } else {
        transactions.push(data);
      }

      renderTransactions();
      renderSummary();
      clearInputs();
    }

    function renderTransactions() {
      const container = document.getElementById("transactions");
      container.innerHTML = "";
      transactions.forEach((t, i) => {
        const div = document.createElement("div");
        div.className = "transaction";
        const who = Object.entries(t.shares).map(([name, amt]) => `${name}: Rp${amt.toLocaleString()}`).join(", ");
        div.innerHTML = `<strong>${t.payer}</strong> paid <strong>Rp${t.amount.toLocaleString()}</strong> for <em>${t.description}</em><br>${who}<br>
          <button onclick="editTransaction(${i})">Edit</button>
          <button onclick="deleteTransaction(${i})">Delete</button>`;
        container.appendChild(div);
      });
    }

    function deleteTransaction(i) {
      if (confirm("Are you sure you want to delete this transaction?")) {
        transactions.splice(i, 1);
        renderTransactions();
        renderSummary();
      }
    }

    function editTransaction(i) {
      const t = transactions[i];
      document.getElementById("payer").value = t.payer;
      document.getElementById("description").value = t.description;
      document.getElementById("amount").value = t.amount;

      document.querySelectorAll(".member").forEach(cb => {
        cb.checked = t.shares.hasOwnProperty(cb.value);
      });

      document.getElementById("splitEqual").checked = false;
      document.getElementById("unequalInputs").style.display = "block";
      renderUnequalInputs();
      for (let name in t.shares) {
        const el = document.getElementById(`amount-${name}`);
        if (el) el.value = t.shares[name];
      }

      deleteTransaction(i);
    }

    function renderSummary() {
      let balance = {};
      members.forEach(m => balance[m] = 0);

      transactions.forEach(({ payer, shares }) => {
        for (let person in shares) {
          if (person !== payer) {
            balance[person] -= shares[person];
            balance[payer] += shares[person];
          }
        }
      });

      const summary = document.getElementById("summary");
      summary.innerHTML = "";
      members.forEach(from => {
        members.forEach(to => {
          if (from !== to) {
            const diff = balance[from] - balance[to];
            if (diff < 0 && Math.abs(diff) > 0) {
              summary.innerHTML += `<div><strong>${from}</strong> owes <strong>${to}</strong>: Rp${(Math.abs(diff / 2)).toLocaleString()}</div>`;
            }
          }
        });
      });
    }

    function clearInputs() {
      document.getElementById("description").value = "";
      document.getElementById("amount").value = "";
      document.querySelectorAll(".member").forEach(cb => cb.checked = true);
      document.getElementById("splitEqual").checked = true;
      document.getElementById("unequalInputs").style.display = "none";
    }
  </script>
</body>
</html>
